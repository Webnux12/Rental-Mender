<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Adalo Ã— Mapbox Directions</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Mapbox GL JS & Directions plugin -->
  <link href="https://api.mapbox.com/mapbox-gl-js/v3.15.0/mapbox-gl.css" rel="stylesheet" />
  <script src="https://api.mapbox.com/mapbox-gl-js/v3.15.0/mapbox-gl.js"></script>
  <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.3.1/mapbox-gl-directions.css" />
  <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.3.1/mapbox-gl-directions.js"></script>
  <style>
    html, body {margin:0; height:100%}
    #map {width:100%; height:100%}
  </style>
</head>
<body>
<div id="map"></div>
<script>
  // === Your Mapbox Token ===
  mapboxgl.accessToken = 'pk.eyJ1IjoiaGluYWdhc2kiLCJhIjoiY21mZ3g2azdjMDRnODJxcXRjOHpzM2U4YyJ9._BQB98uY9L_ZhLut3voPDQ';

  // Parse query params ?origin=lng,lat&destination=lng,lat&profile=driving
  const qs = new URLSearchParams(location.search);
  const getCoord = (key) => {
    const v = qs.get(key);
    if (!v) return null;
    if (v.includes(',')) {
      const [lng, lat] = v.split(',').map(Number);
      if (Number.isFinite(lng) && Number.isFinite(lat)) return [lng, lat];
    }
    return v; // treat as address string
  };

  const origin = getCoord('origin');
  const destination = getCoord('destination');
  const profile = qs.get('profile') || 'driving';
  const unit = qs.get('unit') || 'metric';
  const styleId = qs.get('style') || 'mapbox/streets-v12';
  const zoom = Number(qs.get('zoom')) || 12;

  // Create map
  const map = new mapboxgl.Map({
    container: 'map',
    style: `mapbox://styles/${styleId}`,
    center: [35.5131, 33.8938], // Beirut as default center
    zoom
  });

  // Directions control
  const directions = new MapboxDirections({
    accessToken: mapboxgl.accessToken,
    unit,
    profile: `mapbox/${profile}`,
    controls: {
      inputs: false,
      instructions: true,
      profileSwitcher: false
    }
  });

  map.addControl(directions, 'top-left');

  map.on('load', () => {
    if (origin) directions.setOrigin(origin);
    if (destination) directions.setDestination(destination);

    if (!origin && qs.get('auto') === '1' && navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        (pos) => directions.setOrigin([pos.coords.longitude, pos.coords.latitude]),
        () => {}
      );
    }
  });
</script>
</body>
</html>
